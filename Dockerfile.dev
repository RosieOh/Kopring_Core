# 1단계: Gradle로 빌드
FROM gradle:8.5-jdk21 AS builder

WORKDIR /app
COPY . .

# Plain JAR 제거 후 빌드
RUN gradle clean build --no-daemon && \
    rm -f build/libs/*-plain.jar

# 2단계: JDK 21로 실행용 이미지 구성
FROM openjdk:21-jdk-slim

ENV TZ=Asia/Seoul
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

WORKDIR /app

# 빌드된 JAR 복사 (실행 가능한 JAR만)
COPY --from=builder /app/build/libs/site-0.0.1-SNAPSHOT.jar app.jar

# 애플리케이션 포트 노출
EXPOSE 8080

# JVM 옵션 설정 (개발 환경용)
ENV JAVA_OPTS="-Xms256m -Xmx512m -XX:+UseG1GC -Duser.timezone=Asia/Seoul"

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]





